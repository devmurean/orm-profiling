#!/usr/bin/env php
<?php
require "../vendor/autoload.php";

use App\Profiler;

/** @var array Command line options */
$options = getopt('', [
  'n:',
  'xdebug',
  'memory',
  'help'
]);

if (array_key_exists('help', $options) && $options['help'] === false) {
  echo 'php profiler [commands] ' . PHP_EOL .
    PHP_EOL . 'Commands:' . PHP_EOL .
    '    [--n int]               Number of record in database' . PHP_EOL .
    '    [--memory bool]         (Optional) Indicate that the memory logging is included in test' . PHP_EOL .
    '    [--xdebug string]       (Optional) Xdebug path that will be used in profiling. Xdebug will be automatically activated' . PHP_EOL .
    '    [--help]                Print help' . PHP_EOL;
  return;
}

$profiler = new Profiler(
  n: array_key_exists('n', $options) ? $options['n'] : 10,
  xdebug: array_key_exists('xdebug', $options) ?? false,
  memory: array_key_exists('memory', $options) ?? false,
);

$profiler->crud();
$profiler->st();
$profiler->tpc();
$profiler->tpcc();
  // $profiler->propagation();
